@model List<WebApplication4.Application.Dto.Patient.PatientFeedbackDto>

@{
    Layout = null;
    var posCount = Model.Count(x => x.feedbackSentiment == FeedbackSentiment.Positive);
    var negCount = Model.Count(x => x.feedbackSentiment == FeedbackSentiment.Negative);
    var total = posCount + negCount; 
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics Pro - Binary View</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #05070a;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px 0;
        }

        .chart-wrapper {
            background: #0d1117;
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #30363d;
            margin-bottom: 50px;
            position: relative;
        }

        .section-header {
            border-bottom: 3px solid #30363d;
            padding-bottom: 12px;
            margin-bottom: 25px;
            font-weight: 900;
            font-size: 1.7rem;
            text-align: center;
        }

        .feedback-card {
            background: #12171f;
            border: 1px solid #444c56;
            border-radius: 12px;
            margin-bottom: 18px;
            padding: 20px !important;
            transition: transform 0.2s;
        }

            .feedback-card:hover {
                transform: scale(1.02);
                border-color: #ffffff;
            }

        .pos-indicator {
            border-right: 8px solid #2ecc71 !important;
        }

        .neg-indicator {
            border-right: 8px solid #ff4d4d !important;
        }

        .patient-name {
            color: #58a6ff;
            font-weight: 800;
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        .feedback-text {
            color: #ffffff;
            font-size: 1.1rem;
            line-height: 1.6;
            font-weight: 500;
        }

        .patient-info {
            color: #abb2bf !important;
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }

        .chart-center-text {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

            .chart-center-text h2 {
                font-size: 3.5rem;
                margin: 0;
                text-shadow: 0 0 15px rgba(255,255,255,0.2);
            }
    </style>
</head>
<body>

    <div class="container">
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="display-5 fw-bold text-white">لوحة تحليل مشاعر المرضي</h1>
                <p style="color: #58a6ff; font-weight: bold; font-size: 1.3rem;">تحليل دقيق لـ @total حالة</p>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-5">
                <div class="chart-wrapper shadow-lg">
                    <canvas id="unifiedChart"></canvas>
                    <div class="chart-center-text">
                        <h2 class="fw-bold text-white">@total</h2>
                        <b style="color: white;">إجمالي الحالات</b>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <h4 class="section-header text-success">الآراء الإيجابية (@posCount) 😊</h4>
                @foreach (var item in Model.Where(x => x.feedbackSentiment == FeedbackSentiment.Positive))
                {
                    <div class="card feedback-card pos-indicator shadow">
                        <div class="patient-name">@item.PatientName</div>
                        <p class="feedback-text">@item.Notes</p>
                        <span class="patient-info small">
                            <i class="px-1">📱</i> @item.PhoneNumber | 📍 @item.Address
                        </span>
                    </div>
                }
            </div>

            <div class="col-md-6">
                <h4 class="section-header" style="color: #ff4d4d;">الآراء السلبية (@negCount) ☹️</h4>
                @foreach (var item in Model.Where(x => x.feedbackSentiment == FeedbackSentiment.Negative))
                {
                    <div class="card feedback-card neg-indicator shadow">
                        <div class="patient-name" style="color: #ff4d4d;">@item.PatientName</div>
                        <p class="feedback-text">@item.Notes</p>
                        <span class="patient-info small text-danger font-weight-bold">
                            <i class="px-1">📱</i> @item.PhoneNumber | 📍 @item.Address
                        </span>
                    </div>
                }
            </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('unifiedChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['إيجابي', 'سلبي'],
                datasets: [{
                    data: [@posCount, @negCount],
                    backgroundColor: ['#2ecc71', '#ff4d4d'],
                    borderColor: '#05070a',
                    borderWidth: 6,
                    hoverOffset: 25
                }]
            },
            options: {
                cutout: '80%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#ffffff',
                            font: { size: 18, weight: 'bold' },
                            padding: 30
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>